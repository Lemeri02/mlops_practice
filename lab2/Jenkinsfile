pipeline {

    agent any
    environment {
        PYTHON_VERSION = '3.8.12'
        VENV_NAME = 'venv'
    }


    stages {
            stage('Build Dependencies111') {

            steps {
                sh "ls -la"
            }
        }

        stage('Install Dependencies') {
            steps {
                script {
                    // Установка Python
                    tool name: 'Python', type: 'hudson.plugins.python.PythonInstallation', installation: "${PYTHON_VERSION}"

                    // Создание и активация виртуальной среды
                    sh "python3 -m venv ${VENV_NAME}"
                    sh "source ${VENV_NAME}/bin/activate"

                    // Установка scikit-learn
                    sh "pip install scikit-learn"
                }
            }
        }


//         stage('Build Dependencies') {
//
//             steps {
//                 sh '''
//                     python3 -m venv ./lab2/.venv
//                     . ./lab2/.venv/bin/activate
//                     pip install -r ./lab2/requirements.txt
//                 '''
//             }
//         }
//         stage('Build Dependencies') {
//             steps {
//                 sh "pip install -r requirements.txt"
//             }
//         }
        stage('Create data directory') {
            steps {
                sh 'mkdir -p lab2/data'
            }
        }
        stage('Create model directory') {
            steps {
                sh 'mkdir -p lab2/model'
            }
        }
        stage('Fetch and prepare data') {
            steps {
                sh 'python3 lab2/fetch_data.py'
            }
        }
        stage('Train model') {
            steps {
                sh 'python3 lab2/train_model.py'
            }
        }
        stage('Evaluate model') {
            steps {
                sh 'python3 lab2/evaluate_model.py'
            }
        }
    }
}